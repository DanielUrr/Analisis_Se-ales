<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì° Signal Analyzer Pro</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <!-- Header con Tabs -->
        <div class="header">
            <h1>üì° Signal Analyzer Pro</h1>
            <div class="header-info">
                <div class="status-badge" id="connectionStatus">
                    <div class="status-dot"></div>
                    <span>Conectando...</span>
                </div>
                <div class="status-badge">
                    <span id="systemInfo">Sistema: --</span>
                </div>
            </div>
        </div>

        <!-- Tabs de Navegaci√≥n -->
        <div class="tabs-container">
            <button class="tab-btn active" onclick="switchTab('monitor')">
                üìä Monitor en Tiempo Real
            </button>
            <button class="tab-btn" onclick="switchTab('map')">
                üó∫Ô∏è Mapa de Cobertura
            </button>
        </div>

        <!-- TAB 1: Monitor en Tiempo Real -->
        <!-- TAB 1: Monitor en Tiempo Real -->
        <div id="tab-monitor" class="tab-content active">
            <div class="main-content-extended">
                
                <!-- Panel Izquierdo - WiFi CON Herramientas Avanzadas -->
                <div class="panel panel-left">
                    <div class="card">
                        <div class="card-title">üì∂ WiFi Monitor</div>
                        
                        <div class="rssi-display">
                            <div class="rssi-value" id="wifiRssi">--</div>
                            <div class="rssi-unit">dBm</div>
                        </div>

                        <div class="quality-bar">
                            <div class="quality-fill" id="qualityFill" style="width: 0%"></div>
                            <div class="quality-label" id="qualityLabel">Sin se√±al</div>
                        </div>

                        <div class="info-row">
                            <span class="info-label">Red:</span>
                            <span class="info-value" id="wifiSSID">N/A</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Canal:</span>
                            <span class="info-value" id="wifiChannel">N/A</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Calidad:</span>
                            <span class="info-value" id="wifiQuality">N/A</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Tiempo:</span>
                            <span class="info-value" id="wifiTime">00:00</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Mediciones:</span>
                            <span class="info-value" id="wifiCount">0</span>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">üìà Estad√≠sticas WiFi</div>
                        <div class="info-row">
                            <span class="info-label">Promedio:</span>
                            <span class="info-value" id="wifiAvg">-- dBm</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">M√°ximo:</span>
                            <span class="info-value" id="wifiMax">-- dBm</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">M√≠nimo:</span>
                            <span class="info-value" id="wifiMin">-- dBm</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Variaci√≥n:</span>
                            <span class="info-value" id="wifiVar">-- dBm</span>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">üéõÔ∏è Controles WiFi</div>
                        
                        <div class="toggle-container">
                            <div class="toggle" id="ultraFastToggle" onclick="toggleUltraFast()">
                                <div class="toggle-thumb"></div>
                            </div>
                            <span>‚ö° Modo Ultra-R√°pido (0.1s)</span>
                        </div>

                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Intervalo:</span>
                                <span id="intervalValue">0.5s</span>
                            </div>
                            <input type="range" class="slider" id="intervalSlider" 
                                   min="0.1" max="3" step="0.1" value="0.5">
                        </div>

                        <button class="btn btn-primary" id="wifiBtnStart" onclick="toggleWiFi()">
                            ‚ñ∂ Iniciar WiFi
                        </button>
                        <button class="btn btn-secondary" onclick="testWiFi()">
                            üß™ Probar Conexi√≥n
                        </button>
                        <button class="btn btn-warning" onclick="addMarker()">
                            üîñ Marcar Punto
                        </button>
                        <button class="btn btn-danger" onclick="clearWiFi()">
                            üóëÔ∏è Limpiar Datos
                        </button>
                        <button class="btn btn-purple" onclick="exportWiFi()">
                            üíæ Exportar CSV
                        </button>
                    </div>

                    <!-- NUEVO: Herramientas Avanzadas -->
                    <div class="card">
                        <div class="card-title">üîß Herramientas Avanzadas</div>
                        <button class="btn btn-secondary" onclick="scanAllNetworks()">
                            üì° Escanear Redes
                        </button>
                        <button class="btn btn-secondary" onclick="analyzeChannel()">
                            üìä Analizar Canal
                        </button>
                        <button class="btn btn-purple" onclick="exportToJSON()">
                            üíæ Exportar JSON
                        </button>
                        <button class="btn btn-purple" onclick="exportToCSV()">
                            üìÑ Exportar CSV
                        </button>
                    </div>
                </div>

                <!-- Panel Central-Izquierdo - Bluetooth NUEVO -->
                <div class="panel panel-bluetooth">
                    <div class="card">
                        <div class="card-title">üîµ Bluetooth Scanner</div>
                        <div class="rssi-display">
                            <div class="rssi-value" id="btCount">0</div>
                            <div class="rssi-unit">Dispositivos</div>
                        </div>
                        
                        <div class="slider-container">
                            <div class="slider-label">
                                <span>Intervalo:</span>
                                <span id="btIntervalValue">2.0s</span>
                            </div>
                            <input type="range" class="slider" id="btIntervalSlider" 
                                   min="1" max="10" step="0.5" value="2">
                        </div>
                        
                        <button class="btn btn-purple" id="btBtnStart" onclick="toggleBluetooth()">
                            üîµ Iniciar Escaneo
                        </button>
                        <button class="btn btn-danger" onclick="clearBluetooth()">
                            üóëÔ∏è Limpiar Lista
                        </button>
                        <button class="btn btn-secondary" onclick="exportBluetooth()">
                            üíæ Exportar CSV
                        </button>
                    </div>

                    <!-- Gr√°ficas de Bluetooth -->
                    <div class="card">
                        <div class="card-title">üìä Estad√≠sticas Bluetooth</div>
                        <div class="chart-container-small">
                            <canvas id="btChart"></canvas>
                        </div>
                    </div>

                    <!-- Lista de Dispositivos -->
                    <div class="card" style="flex: 1; display: flex; flex-direction: column;">
                        <div class="card-title">üì± Dispositivos Encontrados</div>
                        <div class="device-list" id="deviceList">
                            <div style="text-align: center; color: #8b92a7; padding: 20px;">
                                Inicia el escaneo para ver dispositivos
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Panel Central-Derecho - Charts WiFi -->
                <div class="panel panel-center">
                    <div class="chart-container">
                        <canvas id="wifiChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="waveChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="histChart"></canvas>
                    </div>
                </div>

                <!-- Panel Derecho - Sistema -->
                <div class="panel panel-right">
                    <div class="card">
                        <div class="card-title">‚ÑπÔ∏è Estado del Sistema</div>
                        <div class="info-row">
                            <span class="info-label">Conexi√≥n:</span>
                            <span class="info-value" id="wsStatus">Desconectado</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">√öltima Act.:</span>
                            <span class="info-value" id="lastUpdate">--</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">WiFi Status:</span>
                            <span class="info-value" id="wifiStatus">Detenido</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">BT Status:</span>
                            <span class="info-value" id="btStatus">Detenido</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- TAB 2: Mapa de Cobertura -->
        <!-- TAB 2 Mapa de Cobertura - VERSI√ìN MEJORADA -->
<div id="tab-map" class="tab-content">
    <div class="map-layout-new">
        
        <!-- Panel Izquierdo: Controles -->
        <div class="map-sidebar">
            
            <!-- Secci√≥n: Modo de Operaci√≥n -->
            <div class="card map-card">
                <div class="card-title">üéØ Modo de Operaci√≥n</div>
                <div class="map-mode-grid">
                    <button class="mode-btn active" data-mode="point" onclick="selectMapMode('point')">
                        <div class="mode-icon">üìç</div>
                        <div class="mode-name">Marcar Punto</div>
                        <div class="mode-desc">Registrar se√±al WiFi</div>
                    </button>
                    <button class="mode-btn" data-mode="router" onclick="selectMapMode('router')">
                        <div class="mode-icon">üì°</div>
                        <div class="mode-name">Ubicar Router</div>
                        <div class="mode-desc">Posici√≥n del AP</div>
                    </button>
                    <button class="mode-btn" data-mode="wall" onclick="selectMapMode('wall')">
                        <div class="mode-icon">üß±</div>
                        <div class="mode-name">Agregar Pared</div>
                        <div class="mode-desc">2 clics para crear</div>
                    </button>
                </div>
            </div>

            <!-- Secci√≥n: Visualizaci√≥n -->
            <div class="card map-card">
                <div class="card-title">üëÅÔ∏è Visualizaci√≥n</div>
                <div class="view-tabs">
                    <button class="view-tab active" data-view="2d" onclick="selectMapView('2d')">
                        <span class="view-icon">üó∫Ô∏è</span>
                        Mapa 2D
                    </button>
                    <button class="view-tab" data-view="heatmap" onclick="selectMapView('heatmap')">
                        <span class="view-icon">üî•</span>
                        Mapa de Calor
                    </button>
                    <button class="view-tab" data-view="3d" onclick="selectMapView('3d')">
                        <span class="view-icon">üì¶</span>
                        Vista 3D
                    </button>
                </div>
            </div>

            <!-- Secci√≥n: Acciones R√°pidas -->
            <div class="card map-card">
                <div class="card-title">‚ö° Acciones R√°pidas</div>
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="startMapMonitoring()">
                        <span id="mapMonitorIcon">‚ñ∂Ô∏è</span> Iniciar Mapeo
                    </button>
                    <button class="btn btn-secondary" onclick="addManualPoint()">
                        ‚ûï Punto Manual
                    </button>
                    <button class="btn btn-warning" onclick="toggleGrid()">
                        <span id="gridIcon">‚úÖ</span> Grid
                    </button>
                    <button class="btn btn-purple" onclick="exportMap()">
                        üíæ Exportar Mapa
                    </button>
                    <button class="btn btn-danger" onclick="clearMap()">
                        üóëÔ∏è Limpiar Todo
                    </button>
                </div>
            </div>

            <!-- Secci√≥n: Estad√≠sticas -->
            <div class="card map-card">
                <div class="card-title">üìä Estad√≠sticas del Mapa</div>
                <div class="map-stats-grid">
                    <div class="stat-box">
                        <div class="stat-icon">üìç</div>
                        <div class="stat-value" id="mapPoints">0</div>
                        <div class="stat-label">Puntos</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-icon">üìè</div>
                        <div class="stat-value" id="mapArea">0</div>
                        <div class="stat-label">√Årea (m¬≤)</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-icon">üì°</div>
                        <div class="stat-value" id="mapAvgRssi">--</div>
                        <div class="stat-label">RSSI Promedio</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-icon">‚≠ê</div>
                        <div class="stat-value" id="mapBestZone">--</div>
                        <div class="stat-label">Mejor Zona</div>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n: Leyenda -->
            <div class="card map-card">
                <div class="card-title">üé® Leyenda de Se√±al</div>
                <div class="legend-list">
                    <div class="legend-item-new">
                        <div class="legend-bar excellent"></div>
                        <div class="legend-info">
                            <span class="legend-title">Excelente</span>
                            <span class="legend-range">-30 a -67 dBm</span>
                        </div>
                    </div>
                    <div class="legend-item-new">
                        <div class="legend-bar good"></div>
                        <div class="legend-info">
                            <span class="legend-title">Buena</span>
                            <span class="legend-range">-67 a -80 dBm</span>
                        </div>
                    </div>
                    <div class="legend-item-new">
                        <div class="legend-bar regular"></div>
                        <div class="legend-info">
                            <span class="legend-title">Regular</span>
                            <span class="legend-range">-80 a -90 dBm</span>
                        </div>
                    </div>
                    <div class="legend-item-new">
                        <div class="legend-bar weak"></div>
                        <div class="legend-info">
                            <span class="legend-title">D√©bil</span>
                            <span class="legend-range">&lt; -90 dBm</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Panel Central: Canvas del Mapa -->
        <div class="map-main-area">
            <div class="map-canvas-wrapper">
                <!-- Barra de informaci√≥n superior -->
                <div class="map-info-bar">
                    <div class="map-info-item">
                        <span class="info-badge" id="currentMode">üìç Modo: Marcar Punto</span>
                    </div>
                    <div class="map-info-item">
                        <span class="info-coords" id="mapCoords">X: 0m, Y: 0m</span>
                    </div>
                    <div class="map-info-item">
                        <span class="info-badge" id="mapStatus">‚è∏Ô∏è Mapeo Detenido</span>
                    </div>
                </div>

                <!-- Canvas del mapa -->
                <div class="canvas-container">
                    <canvas id="mapCanvas" width="1200" height="800"></canvas>
                    <div id="map3dContainer" style="display: none;"></div>
                </div>

                <!-- Controles flotantes en el canvas -->
                <div class="canvas-controls">
                    <button class="canvas-btn" onclick="zoomIn()" title="Acercar">
                        <span>üîç+</span>
                    </button>
                    <button class="canvas-btn" onclick="zoomOut()" title="Alejar">
                        <span>üîç-</span>
                    </button>
                    <button class="canvas-btn" onclick="resetView()" title="Restablecer vista">
                        <span>üîÑ</span>
                    </button>
                    <button class="canvas-btn" onclick="fullscreenMap()" title="Pantalla completa">
                        <span>‚õ∂</span>
                    </button>
                </div>

                <!-- Ayuda flotante -->
                <div class="map-help-tooltip">
                    <div class="help-header">üí° Ayuda R√°pida</div>
                    <ul>
                        <li><strong>Marcar Punto:</strong> Clic para agregar medici√≥n WiFi</li>
                        <li><strong>Ubicar Router:</strong> Clic para colocar router</li>
                        <li><strong>Agregar Pared:</strong> 2 clics para trazar pared</li>
                        <li><strong>Vista:</strong> Cambia entre 2D, Heatmap y 3D</li>
                    </ul>
                </div>
            </div>
        </div>

    </div>
</div>

        <!-- Footer -->
        <div class="footer">
            <div class="stats-bar">
                <div class="stat-item">
                    <span class="stat-label">Datos WiFi</span>
                    <span class="stat-value" id="totalWifiData">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Dispositivos BT</span>
                    <span class="stat-value" id="totalBtDevices">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Puntos Mapa</span>
                    <span class="stat-value" id="totalMapPoints">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Sesi√≥n</span>
                    <span class="stat-value" id="sessionTime">00:00</span>
                </div>
            </div>
            <div style="color: #8b92a7; font-size: 0.9rem;">
                Signal Analyzer Pro v2.0 - Real-Time Edition | Con Mapeo de Cobertura
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
    <script src="/static/map.js"></script>

</body>
</html>